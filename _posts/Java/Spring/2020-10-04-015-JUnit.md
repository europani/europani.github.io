---
layout: post
title: JUnit
categories: Spring
tags: [Spring, Junit]
---
Junit5 : Junit Platform + Junit Jupiter + Junit Vintage 모듈로 구성
1. Junit Platform : 테스트 프레임워크의 기본 API 제공
2. Junit Jupiter : Junit5의 새롭게 확장된 모델 제공
3. Junit Vintage : 하위 호환성을 위하여 Junit4, Junit3를 실행할 수 있는 모듈 제공


### 어노테이션
#### 테스트
1. `@Test` : 단위테스트 메서드 명시
```java
@Test
void test() {
    ...
}
```

2. `@ParameterizedTest` : 매개변수가 있는 테스트 메서드 명시
```java
@ParameterizedTest
@ValueSource(string = {"europani"})
void test(String name) {
    ...
}
```

3. `@RepeatedTest` : 반복되는 테스트 메서드 명시
```java
@RepeatedTest(3)
void test() {
    ...
}
```

4. `@Disabled` : 테스트 비활성화

#### 라이프사이클
  - `@BeforeAll` -> `@BeforeEach` -> `@Test` -> `@AfterEach` -> `@AfterAll` 사이클 순서

1. `@BeforeAll` : 모든 테스트 전에 실행될 메서드 명시(테스트 클래스 수행시 1번만 실행)
   
2. `@AfterAll` : 모든 테스트 후에 실행될 메서드 명시(테스트 클래스 종료시 1번만 실행)

3. `@BeforeEach` : 각 단위테스트 전 마다 실행되는 메서드

4. `@AfterEach` : 각 단위테스트 후 마다 실행되는 메서드
   
#### 기타
1. `@DisplayName` : 테스트 이름 지정 
   
2. `@Tag` : 테스트 필터링을 위한 태그 선언
   
3. `@Timeout` : 실행시간 제한 (실행시간을 초과하면 테스트 실패처리)
   
4. `@Order` : 테스트 순서 지정

```java
@Test
@Order(1)
void test_value() {
    ...
}

@Test
@Order(2)
void test_empty() {
    ...
}
```

#### assert 메서드

|assert 메서드|설명|
|:---:|:---:|
|assertArrayEquals(a, b)|배열 a와 b가 일치하는지 확인|
|assertEquals(a, b)|객체 a와 b가 같은 값인지 확인|
|assertSame(a, b)|객체 a와 b가 같은 객체인지 확인|
|assertTrue(a)|조건 a가 참인지 확인|
|assertNotNull(a)|객체 a가 not Null인지 확인|
|assertThat(a).~~~|객체 a가 뒤에 설정한 특정상황 만족하는지 확인(커스터마이징)|
|assertThrows(exception.class)|해당 exception가 발생하는지 확인|
|fail()|테스트 실패처리|


#### Spring-Test 어노테이션

1. `@ExtendWith(SpringRunner.class)` : JUnit 테스트를 스프링 프레임워크와 통합 (테스트가 스프링 컨테이너에서 실행된다)

2. `@ContextConfiguration` : 스프링 설정파일 지정

3. `@SpringBootTest` : Spring Boot를 사용하는 경우 (테스트에 필요한 거의 모든 의존성을 제공)


### 테스트 케이스 작성
#### 테스트 작성법  
(1) given : 주어진 것  
(2) when : 실행했을때  
(3) then : 결과


```java
// 도메인
@Getter
@Setter
@NoArgsConstructor
public class Member {
      private Long id;
      private String name;
}

// 서비스
public class MemberService {
      private final MemberRepository memberRepository;

      public MemberService(MemberRepository memberRepository) {
          this.memberRepository = memberRepository;
      }
      ... 
}

// 리포지토리 인터페이스
public interface MemberRepository {
      Member save(Member member);
      Optional<Member> findById(Long id);
}

// 리포지토리 구현체
public class MemoryMemberRepository implements MemberRepository {
      private static Map<Long, Member> store = new HashMap<>();
      private static long sequence = 0L;

      @Override
      public Member save(Member member) {
          member.setId(++sequence);
          store.put(member.getId(), member);
          return member;
      }

      @Override
      public Optional<Member> findById(Long id) {
          return Optional.ofNullable(store.get(id));
      }

      public void clearStore() {
          store.clear();
        }
}
```


```java
@Transactional
class MemoryMemberRepositoryTest {
    MemoryMemberRepository repository = new MemoryMemberRepository();

    @AfterEach
    public void afterEach() {       // 여러번 테스트를 위해 매 테스트가 끝나면 cleanup
        repository.clearStore();
    }

    @Test
    public void save() {
        // 1. given
        Member member = new Member();
        member.setName("spring");

        // 2. when
        repository.save(member);

        // 3. then
        Member result = repository.findById(member.getId()).get();
        assertThat(result).isEqualTo(member);
    }
```