---
layout: post
title: 'Spring Redis'
categories: Spring
tags: [Spring]
---

### Redis
- key-value 구조의 인메모리 데이터베이스
- Redis 특징
  - Collection(List, Set, SortedSet, Hash) 지원
  - 싱글 쓰레드로 Race Condition 방지
- 활용방안
  - 캐싱, 세션 저장, 메시지 큐, 실시간채팅, 랭킹, 분산락

Spring에서 Redis Client로 `Jedis`와 `Lettuce`가 있다  
Redis Client로 성능상 우위에 있는 `Lettuce`를 사용할 것이다

### Redis 로컬 초기 셋팅
- docker 컨테이너로 Redis 실행

```command
$ docker run -p 6379:6379 --name redis -d redis
$ docker exec -it redis /bin/bash
$ redis-cli
```

### Config

```gradle
implementation 'org.springframework.boot:spring-boot-starter-data-redis'
```

```java
@RequiredArgsConstructor
@Configuration
// @EnableRedisRepositories         // Redis Repository 활성화
public class RedisRepositoryConfig {

    @Value("${spring.cache.redis.host}")
    private String host;

    @Value("${spring.cache.redis.port}")
    private int port;

    // Lettuce 사용
    @Bean
    public RedisConnectionFactory redisConnectionFactory() {
        return new LettuceConnectionFactory(host, port);
    }

    @Bean
    public RedisTemplate<String, Object> redisTemplate() {      // serializer 설정
        RedisTemplate<String, Object> redisTemplate = new RedisTemplate<>();
        redisTemplate.setConnectionFactory(redisConnectionFactory());
        redisTemplate.setKeySerializer(new StringRedisSerializer());
        redisTemplate.setValueSerializer(new StringRedisSerializer());
        // redisTemplate.setDefaultSerializer(new StringRedisSerializer());
        return redisTemplate;
    }
}

```

---

`spring-data-redis`는 접근방식으로 2가지를 제공한다.
### 1. RedisTemplate
- 자료구조 기반으로 Redis를 사용
- 자료구조별 Method

|Method|Description|
|:--:|:--:|
|opsForValue()|String Interface|
|opsForList()|List Interface|
|opsForSet()|Set Interface|
|opsForZSet()|SortedSet Interface|
|opsForHash()|Hash Interface|

![image](https://github.com/europani/europani.github.io/assets/48157259/ab9db6f3-23c2-4968-b2c1-a72e2428653f)

```java

```


### 2. RedisRepository
- 객체 기반으로 Redis를 사용

```java
@Getter
@Setter
@RedisHash(value = "member", timeToLive = 3600)        // redis key prefix
public class Member {

    @Id
    private String id;      // id역할을 할 필드
    private String name;
    private int age;

    public Member(String name, int age) {
        this.name = name;
        this.age = age;
    }
}
```

```java
public interface MemberRedisRepository extends CrudRepository<Member, String> {}
```

```java

```