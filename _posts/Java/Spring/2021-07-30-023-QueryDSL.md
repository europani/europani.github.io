---
layout: post
title: QueryDSL
categories: Spring
tags: [Spring, JPA]
---
JPQL을 생성하는 빌더역할을 하는데 코드가 JPQL과 비슷해 가독성이 좋다.  
QueryDSL은 보통 복잡한 SELECT문을 위해 사용한다.

- 쿼리타입(Q) 
  - QueryDSL을 사용 하려면 쿼리 타입이라는 쿼리용 클래스가 있어야 한다.
  - 쿼리 타입은 기본 인스턴스를 보관하고 있다. 하지만, 같은 엔티티를 서브쿼리에 사용하면 같은 별칭이 사용되므로 별칭을 직접 지정해야 한다.

```java
@Entity
@Table(name = "member")
public class MemberEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int id;
    
    @Column(nullable = false)
    private String name;
}

```
→ QueryDSL은 MemberEntity 동일한 패키지에 `QMemberEntity`라는 이름을 가진 쿼리 타입을 생성한다.

```java
// 기본 인스턴스를 사용하여 쿼리 타입에 접근
QMemberEntity qMember = QMemberEntity.memberEntity;

// 별칭을 직접 지정하여 쿼리 타입에 접근
QMemberEntity qMember = new QMemberEntity("m");      // 생성되는 JPQL의 별칭 = m
```


### 기본 문법
- SELECT문

```java
public void queryDSL() {

    EntityManager em = emf.createEntityManager();

    JPAQuery query = new JPAQuery(em);
    QMemberEntity qMember = QMemberEntity.memberEntity;     // 기본 인스턴스 사용

    // SELECT qMember FROM QMemberEntity qMember WHERE qMember.name=?1
    List<MemberEntity> list = query.from(qMember)
                .where(qMember.name.eq("europani"))
                .list(qMember);     // 출력한 컬럼 선택
}
```


### Spring Data JPA와 QueryDSL 함께 사용하기
- `org.springframework.data.querydsl.QueryDslRepositorySupport` 추상클래스 사용
- 리포지토리 구현체에서 추상클래스를 구현한다.
  
```java
public interface MemberRepository extends JpaRepository<MemberEntity, Integer> {
    List<MemberEntity> findByName(String name);
}

@Repository
public class MemberRepositoryImpl extends QuerydslRepositorySupport {
    ...
}
```

[QuertySQL 레퍼런스(링크)](https://querydsl.com/static/querydsl/4.0.1/reference/ko-KR/html_single/)